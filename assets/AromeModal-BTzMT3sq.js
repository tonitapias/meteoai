import{j as e,g as H}from"./index-DHlSO-8t.js";import{r,X as O,D as W,W as L}from"./vendor-react-BZ5tFjZ7.js";function P(){const[o,l]=r.useState(null),[b,j]=r.useState(!1),[s,d]=r.useState(null),h=r.useCallback(async(u,g)=>{j(!0),d(null);try{const p=`https://api.open-meteo.com/v1/forecast?${new URLSearchParams({latitude:u,longitude:g,hourly:"temperature_2m,relative_humidity_2m,precipitation,weather_code,wind_speed_10m,wind_gusts_10m,cape,is_day",models:"arome_france",timezone:"auto",forecast_days:2}).toString()}`,c=await fetch(p);if(!c.ok)throw c.status===400?new Error("Ubicació fora del rang del model AROME (Només Europa Occidental/Pirineus)."):new Error(`Error connectant amb MeteoFrance: ${c.status}`);const m=await c.json();l({hourly:m.hourly,hourly_units:m.hourly_units,elevation:m.elevation})}catch(i){console.error(i),d(i.message||"Error desconegut carregant AROME")}finally{j(!1)}},[]),x=r.useCallback(()=>{l(null),d(null)},[]);return{aromeData:o,loading:b,error:s,fetchArome:h,clearArome:x}}function Y({lat:o,lon:l,onClose:b,lang:j="ca"}){const{aromeData:s,loading:d,error:h,fetchArome:x,clearArome:u}=P(),g=r.useRef(null);r.useEffect(()=>(o&&l&&x(o,l),()=>u()),[o,l,x,u]);const i=r.useMemo(()=>{if(!s)return[];const t=new Date,a=t.getFullYear(),v=String(t.getMonth()+1).padStart(2,"0"),N=String(t.getDate()).padStart(2,"0"),f=`${a}-${v}-${N}`,w=t.getHours(),k=[],{time:E,temperature_2m:A,precipitation:R,weather_code:S,wind_speed_10m:$,wind_gusts_10m:C,cape:D,is_day:F}=s.hourly;return E.forEach((y,n)=>{const _=y.slice(0,10),z=y.slice(11,13),M=parseInt(z,10);_<f||_===f&&M<w||k.push({time:y,hour:M,date:_,temp:A[n],precip:R[n],code:S[n],wind:$[n],gust:C[n],cape:D?D[n]:0,isDay:F[n]===1})}),k},[s]),p=s?Math.max(...s.hourly.wind_gusts_10m):0,c=s?Math.max(...s.hourly.cape):0,m=s?s.hourly.precipitation.reduce((t,a)=>t+a,0):0;return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-950/80 backdrop-blur-md animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-slate-900 border border-fuchsia-500/30 w-full max-w-2xl max-h-[90vh] overflow-hidden rounded-3xl shadow-2xl relative flex flex-col",children:[e.jsxs("div",{className:"bg-slate-900/95 backdrop-blur border-b border-white/5 p-5 flex justify-between items-start z-20 shrink-0",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("span",{className:"bg-fuchsia-600 text-white text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-wider",children:"HD Live"}),e.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-white tracking-tight",children:["AROME ",e.jsx("span",{className:"text-fuchsia-400",children:"1.3km"})]})]}),e.jsx("p",{className:"text-slate-400 text-xs md:text-sm",children:"Detall hora a hora d'alta precisió."})]}),e.jsx("button",{onClick:b,className:"p-2 bg-slate-800 rounded-full hover:bg-slate-700 text-slate-400 hover:text-white transition-colors",children:e.jsx(O,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-0",ref:g,children:[d&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 space-y-4",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-fuchsia-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-fuchsia-300 animate-pulse text-sm",children:"Carregant dades HD..."})]}),h&&e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("p",{className:"text-red-400 font-medium mb-2",children:h}),e.jsx("button",{onClick:()=>x(o,l),className:"mt-2 px-4 py-2 bg-slate-800 text-white rounded-lg text-sm",children:"Reintentar"})]}),s&&!d&&e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 p-4 bg-slate-800/30 border-b border-white/5",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] uppercase text-slate-500 font-bold mb-1",children:"Pluja Total"}),e.jsxs("div",{className:"text-xl font-bold text-blue-200",children:[m.toFixed(1),e.jsx("span",{className:"text-xs font-normal text-slate-500",children:"mm"})]})]}),e.jsxs("div",{className:"text-center border-l border-white/5",children:[e.jsx("div",{className:"text-[10px] uppercase text-slate-500 font-bold mb-1",children:"Ràfega Màx"}),e.jsxs("div",{className:`text-xl font-bold ${p>50?"text-teal-300":"text-slate-200"}`,children:[Math.round(p),e.jsx("span",{className:"text-xs font-normal text-slate-500",children:"km/h"})]})]}),e.jsxs("div",{className:"text-center border-l border-white/5",children:[e.jsx("div",{className:"text-[10px] uppercase text-slate-500 font-bold mb-1",children:"Energia"}),e.jsxs("div",{className:`text-xl font-bold ${c>800?"text-amber-400":"text-slate-200"}`,children:[Math.round(c),e.jsx("span",{className:"text-xs font-normal text-slate-500",children:"J/kg"})]})]})]}),e.jsxs("div",{className:"divide-y divide-white/5",children:[i.map((t,a)=>{const v=a>0&&i[a-1].date!==t.date,N=a===0,f=t.precip>0,w=t.gust>40;return e.jsxs("div",{className:"relative group",children:[N&&e.jsx("div",{className:"sticky top-0 z-10 bg-slate-900/95 backdrop-blur py-1.5 px-4 text-[10px] font-bold uppercase text-slate-400 tracking-widest border-b border-white/5 shadow-sm",children:"Avui"}),v&&e.jsx("div",{className:"sticky top-0 z-10 bg-slate-900/95 backdrop-blur py-1.5 px-4 text-[10px] font-bold uppercase text-fuchsia-400 tracking-widest border-y border-fuchsia-500/20 shadow-sm mt-2",children:"Demà"}),e.jsxs("div",{className:`flex items-center justify-between p-4 transition-colors ${f?"bg-blue-900/10":"hover:bg-white/5"}`,children:[e.jsxs("div",{className:"flex items-center gap-4 w-1/3",children:[e.jsxs("div",{className:"text-center min-w-[3rem]",children:[e.jsxs("div",{className:"text-lg font-bold text-white",children:[t.hour,":00"]}),a===0&&e.jsx("div",{className:"text-[9px] text-fuchsia-400 font-bold uppercase animate-pulse",children:"Ara"})]}),e.jsx("div",{className:"relative",children:H(t.code,"w-10 h-10",t.isDay)})]}),e.jsxs("div",{className:"flex-1 flex justify-center items-center gap-6",children:[e.jsxs("div",{className:"text-xl font-bold text-slate-200 w-12 text-right",children:[Math.round(t.temp),"°"]}),e.jsx("div",{className:"w-16 flex flex-col items-center",children:t.precip>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1 text-blue-300 font-bold",children:[e.jsx(W,{className:"w-3 h-3"}),t.precip>=10?Math.round(t.precip):t.precip.toFixed(1)]}),e.jsx("div",{className:"h-1 w-full bg-slate-700 rounded-full mt-1 overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500",style:{width:`${Math.min(t.precip*10,100)}%`}})})]}):e.jsx("span",{className:"text-slate-600 text-xs",children:"-"})})]}),e.jsxs("div",{className:"w-1/4 flex flex-col items-end",children:[e.jsxs("div",{className:`flex items-center gap-1.5 font-bold ${w?"text-teal-300":"text-slate-400"}`,children:[e.jsx(L,{className:"w-3.5 h-3.5"}),Math.round(t.gust)]}),e.jsx("div",{className:"text-[10px] text-slate-500 uppercase",children:"km/h"})]})]})]},t.time)}),i.length===0&&e.jsx("div",{className:"p-8 text-center text-slate-500",children:"Dades no disponibles per a aquesta hora."})]})]})]})]})})}export{Y as default};
